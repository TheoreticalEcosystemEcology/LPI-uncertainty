# LPI demo

## Example 1: full time series

Say we have 3 populations: one that has doubled, one that has remained stable, and one that has been halved.

```{r}
# make populations
A <- 10:15        # 50% increase
B <- rep(10,6)    # stable
C <- 10:5         # 50% decline
time <- 1:6          # time steps
# plot them
plot(time, A, type = "l", ylim = c(0,20), ylab = "Abundance", xlab = "time")
lines(B)
lines(C)
```

Th

### Step 1: Calculate annual growth rates of each population

Population growth rates are calculated as the ratio of abundances at each time step compared to the previous time step:

$ dt = N/{N_{t-1}}$

```{r}
# function to calculate growth rate as ratio
dt <- function(x){
  dt <- vector("numeric", length(x))
  dt[1] = 1
  for(t in 2:length(x)){
    dt[t] <- x[t]/x[t-1]
  }
  return(dt)
}

# calculate growth rates
dtA <- dt(A) 
dtB <- dt(B)
dtC <- dt(C)
# plot them
plot(time, dtA, type = "l", ylim = c(0,2), ylab = "Growth rate", xlab = "time")
lines(dtB)
lines(dtC)
```

### Step 2: Get annual (geometric) mean growth rate

For each time step, we then take the geometric mean of the annual growth rates of the three populations:

$\overline{dt} = (dt_A * dt_B * dt_C)^{1/3}$

```{r}
df <- cbind(dtA, dtB, dtC)
means <- apply(df, 1, function(x) prod(x, na.rm = TRUE)^(1/3))
df <- as.data.frame(cbind(df, means))

# plot them
plot(time, dtA, type = "l", ylim = c(0,2), ylab = "Growth rate", xlab = "time")
lines(dtB)
lines(dtC)
# add mean line to plot
lines(df$means, col = "red", lwd = 2)
```

### Step 3: Calculate index

We then calculate the index, which converts these growth rates relative to baseline value of 1 at the first time step:

$I_t = I_{t-1}*10^{\overline{dt}}$

```{r}
# function to calculate LPI from mean dt
calclpi <- function(dt){
  # calculate index value
  lpi = c(1) # initial value is 1 
  for(i in 2:length(dt)){
    lpi[i] <- lpi[i-1]*10^dt[i] }
  return(lpi)
}

lpi <- calclpi(log10(df$means))
plot(lpi ~ time, type = "l")
```

